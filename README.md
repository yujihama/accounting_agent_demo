# è«‹æ±‚æ›¸ã‚«ãƒƒãƒˆã‚ªãƒ•ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«

çµŒç†æ¥­å‹™ã«ãŠã‘ã‚‹è«‹æ±‚æ›¸ã®ã‚«ãƒƒãƒˆã‚ªãƒ•ãƒã‚§ãƒƒã‚¯ã‚’è‡ªå‹•åŒ–ã™ã‚‹AIãƒ„ãƒ¼ãƒ«ã§ã™ã€‚GPT-4.1ã‚’æ´»ç”¨ã—ã¦ã€å¤§é‡ã®è«‹æ±‚æ›¸ã‚’åŠ¹ç‡çš„ã«ãƒã‚§ãƒƒã‚¯ã—ã€ä¼šè¨ˆåŸºæº–ã‚„çµŒè²»ç²¾ç®—ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ãŸæ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚

## æ©Ÿèƒ½

- **è‡ªå‹•è«‹æ±‚æ›¸ãƒã‚§ãƒƒã‚¯**: GPT-4.1ã‚’ä½¿ç”¨ã—ãŸé«˜ç²¾åº¦ãªè«‹æ±‚æ›¸å†…å®¹ã®æ¤œè¨¼ï¼ˆStructured Outputå¯¾å¿œï¼‰
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«è¨­å®š**: ä¼šè¨ˆåŸºæº–ã‚„çµŒè²»ç²¾ç®—ãƒ«ãƒ¼ãƒ«ã‚’è‡ªç”±ã«è¨­å®šå¯èƒ½
- **ğŸ†• AIãƒ«ãƒ¼ãƒ«ææ¡ˆæ©Ÿèƒ½**: ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚„è¦å®šæ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã‚’ææ¡ˆ
  - PDFã€Wordã€Excelã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å†…å®¹ã‚’è§£æ
  - æ—¢å­˜ãƒ«ãƒ¼ãƒ«ã¨ã®é‡è¤‡ã‚’å›é¿ã—ãŸæ–°ã—ã„ãƒ«ãƒ¼ãƒ«ææ¡ˆ
  - ææ¡ˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã®ç·¨é›†ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½
- **ä¸¦åˆ—å‡¦ç†**: è¨­å®šå¯èƒ½ãªä¸¦åˆ—å‡¦ç†æ•°ï¼ˆ1-12ï¼‰ã§å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŠ¹ç‡çš„ã«å‡¦ç†
- **å¤šæ§˜ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼å¯¾å¿œ**: PDFã€Excel (.xlsx, .xls)ã€Word (.docx) ã«å¯¾å¿œ
- **è©³ç´°ãªçµæœãƒ¬ãƒãƒ¼ãƒˆ**: Excelå½¢å¼ã§ã®çµæœå‡ºåŠ›ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³è¡¨ç¤º**: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨å‡¦ç†å®Œäº†æ•°ã®è¡¨ç¤º
- **é«˜åº¦ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: è¦ç¢ºèªãƒ»æ­£å¸¸ãƒ»å…¨ä»¶ã§ã®çµæœè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Streamlit**: Webãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **LangChain**: GPT-4.1ã¨ã®é€£æºã¨Pydantic Output Parser
- **OpenAI GPT-4.1**: è«‹æ±‚æ›¸å†…å®¹ã®åˆ†æã¨æ¤œè¨¼ï¼ˆãƒ¢ãƒ‡ãƒ«å›ºå®šï¼‰
- **Pydantic v2**: å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã¨Structured Output
- **Python 3.8+**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- **pandas**: Excelãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- **PyPDF2 / PyMuPDF**: PDFæ–‡æ›¸ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
- **python-docx**: Wordæ–‡æ›¸å‡¦ç†
- **concurrent.futures**: ä¸¦åˆ—å‡¦ç†ã¨ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ç®¡ç†

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### æ–¹æ³•1: PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```powershell
# ä»®æƒ³ç’°å¢ƒã®ä½œæˆã€ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚¢ãƒ—ãƒªèµ·å‹•ã‚’è‡ªå‹•å®Ÿè¡Œ
.\run.ps1
```

### æ–¹æ³•2: æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. ä»®æƒ³ç’°å¢ƒã®ä½œæˆã¨æœ‰åŠ¹åŒ–

```powershell
# ä»®æƒ³ç’°å¢ƒã®ä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–
.\venv\Scripts\Activate.ps1
```

#### 2. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```powershell
pip install -r requirements.txt
```

#### 3. OpenAI APIã‚­ãƒ¼ã®æº–å‚™

OpenAI ã®APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§è¨­å®šã§ãã¾ã™ã€‚

#### 4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

```powershell
streamlit run app.py
```

### ä¾å­˜é–¢ä¿‚

å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ä¸»è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼š
- streamlit >= 1.28.0
- langchain >= 0.0.340 
- langchain-openai >= 0.0.2
- openai >= 1.3.0
- pandas >= 2.0.0
- python-docx >= 0.8.11
- PyPDF2 >= 3.0.0
- openpyxl >= 3.1.0
- xlsxwriter >= 3.1.0
- pydantic >= 2.0.0

## ä½¿ç”¨æ–¹æ³•

### 1. APIã‚­ãƒ¼è¨­å®š

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å¾Œã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§OpenAI APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚GPT-4.1ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€é©åˆ‡ãªAPIã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚

### 2. ãƒ«ãƒ¼ãƒ«è¨­å®š

ã€Œãƒ«ãƒ¼ãƒ«è¨­å®šã€ã‚¿ãƒ–ã§è«‹æ±‚æ›¸ãƒã‚§ãƒƒã‚¯ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ï¼š

#### æ‰‹å‹•ãƒ«ãƒ¼ãƒ«è¿½åŠ 
- **ãƒ«ãƒ¼ãƒ«å**: ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã®è­˜åˆ¥å
- **ã‚«ãƒ†ã‚´ãƒª**: æ—¥ä»˜ãƒã‚§ãƒƒã‚¯ã€é‡‘é¡ãƒã‚§ãƒƒã‚¯ã€æ‰¿èªãƒã‚§ãƒƒã‚¯ã€æ›¸å¼ãƒã‚§ãƒƒã‚¯ã€ãã®ä»–
- **ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã®å†…å®¹**: GPT-4.1ã«é€ä¿¡ã™ã‚‹å…·ä½“çš„ãªæŒ‡ç¤º

#### ğŸ†• AIãƒ«ãƒ¼ãƒ«ææ¡ˆæ©Ÿèƒ½
ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚„è¦å®šæ›¸ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ«ã‚’ææ¡ˆã™ã‚‹æ–°æ©Ÿèƒ½ï¼š

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ä¼šè¨ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã€è«‹æ±‚æ›¸ãƒã‚§ãƒƒã‚¯è¦å®šã€å†…éƒ¨çµ±åˆ¶æ–‡æ›¸ãªã©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. **AIåˆ†æ**: GPT-4ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…å®¹ã‚’åˆ†æã—ã€è«‹æ±‚æ›¸ãƒã‚§ãƒƒã‚¯ã«é–¢é€£ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’æŠ½å‡º
3. **é‡è¤‡å›é¿**: æ—¢å­˜ãƒ«ãƒ¼ãƒ«ã¨ã®é‡è¤‡ã‚’è‡ªå‹•çš„ã«å›é¿
4. **ãƒ«ãƒ¼ãƒ«ææ¡ˆ**: ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ä»˜ãã§ãƒ«ãƒ¼ãƒ«ã‚’ææ¡ˆ
5. **ç·¨é›†ãƒ»è¿½åŠ **: ææ¡ˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¦ã‹ã‚‰è¿½åŠ å¯èƒ½

**å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼**: PDFã€Word (.docx)ã€Excel (.xlsx)ã€ãƒ†ã‚­ã‚¹ãƒˆ (.txt, .md)

#### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ãŒåˆæœŸè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼š

- **è«‹æ±‚æ›¸æ—¥ä»˜ãƒã‚§ãƒƒã‚¯**: è«‹æ±‚æ›¸ã®æ—¥ä»˜ãŒä¼šè¨ˆæœŸé–“å†…ï¼ˆæœŸæœ«æ—¥ä»¥å‰ï¼‰ã‹ã©ã†ã‹ã‚’ç¢ºèª
- **é‡‘é¡æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**: ç¨è¾¼é‡‘é¡ã¨ç¨æŠœé‡‘é¡ã®è¨ˆç®—ã€æ¶ˆè²»ç¨ç‡ã®ç¢ºèª
- **å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯**: è«‹æ±‚è€…åã€è«‹æ±‚æ—¥ã€æ”¯æ‰•æœŸé™ã€é‡‘é¡ã€å†…å®¹ã€æŒ¯è¾¼å…ˆã®è¨˜è¼‰ç¢ºèª
- **æ‰¿èªå°ãƒã‚§ãƒƒã‚¯**: æ‰¿èªå°ã‚„ç½²åã®æœ‰ç„¡ã‚’ç¢ºèª
- **æ”¯æ‰•æ¡ä»¶ãƒã‚§ãƒƒã‚¯**: æ”¯æ‰•æ¡ä»¶ã‚„æœŸé™ã®é©åˆ‡æ€§ã‚’ç¢ºèª

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¿ãƒ–ã§è«‹æ±‚æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼š

- **å¯¾å¿œå½¢å¼**: PDFã€Excel (.xlsx, .xls)ã€Word (.docx)
- **è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«**: ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: æœ€å¤§50MB/ãƒ•ã‚¡ã‚¤ãƒ«
- **è‡ªå‹•å‡¦ç†**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã€ãƒœã‚¿ãƒ³ã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º

### 4. ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ

ã€Œãƒã‚§ãƒƒã‚¯å®Ÿè¡Œã€ã‚¿ãƒ–ã§ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

#### å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
- ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡¦ç†æ¸ˆã¿ã‹
- ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«: 1ã¤ä»¥ä¸Šã®ãƒ«ãƒ¼ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹  
- APIè¨­å®š: OpenAI APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹

#### å®Ÿè¡Œè¨­å®š
- **é©ç”¨ã™ã‚‹ãƒ«ãƒ¼ãƒ«**: å®Ÿè¡Œã—ãŸã„ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã‚’è¤‡æ•°é¸æŠå¯èƒ½
- **å‡¦ç†å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
- **ä¸¦åˆ—å‡¦ç†æ•°**: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã§è¨­å®šï¼ˆ1-12ã®ç¯„å›²ï¼‰
- **æ¨å®šå‡¦ç†æ™‚é–“**: ç·ãƒã‚§ãƒƒã‚¯æ•°ã¨ä¸¦åˆ—æ•°ã‹ã‚‰è‡ªå‹•è¨ˆç®—

### 5. çµæœç¢ºèª

ã€Œçµæœè¡¨ç¤ºã€ã‚¿ãƒ–ã§çµæœã‚’ç¢ºèªã§ãã¾ã™ï¼š

#### ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- **ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: å‡¦ç†ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç·æ•°
- **è¦ç¢ºèª**: ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯è­¦å‘ŠãŒã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ•°
- **æ­£å¸¸**: ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒæ­£å¸¸ãªãƒ•ã‚¡ã‚¤ãƒ«æ•°

#### è©³ç´°çµæœ
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½**: ã™ã¹ã¦ãƒ»è¦ç¢ºèªãƒ»æ­£å¸¸ã§ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥çµæœ**: å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’è©³ç´°è¡¨ç¤º
- **é‡è¦åº¦è¡¨ç¤º**: infoï¼ˆæ­£å¸¸ï¼‰ãƒ»warningï¼ˆè­¦å‘Šï¼‰ãƒ»errorï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰
- **Excelå‡ºåŠ›**: çµæœã‚’ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãExcelãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
extract_invoice/
â”œâ”€â”€ app.py                            # ãƒ¡ã‚¤ãƒ³Streamlitã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ invoice_checker.py                # è«‹æ±‚æ›¸ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼ˆGPT-4.1é€£æºï¼‰
â”œâ”€â”€ rule_manager.py                   # ãƒ«ãƒ¼ãƒ«ç®¡ç†æ©Ÿèƒ½
â”œâ”€â”€ file_processor.py                 # ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†æ©Ÿèƒ½ï¼ˆPDF/Excel/Wordå¯¾å¿œï¼‰
â”œâ”€â”€ requirements.txt                  # å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§
â”œâ”€â”€ run.ps1                          # PowerShellèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ rules.json                       # ãƒ«ãƒ¼ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ config.sample.py                 # è¨­å®šã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ sample_usage.py                  # ä½¿ç”¨ä¾‹ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ structured_output_demo.py        # Structured Outputå‹•ä½œç¢ºèª
â”œâ”€â”€ test_basic.py                    # åŸºæœ¬ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ venv/                           # Pythonä»®æƒ³ç’°å¢ƒ
â””â”€â”€ README.md                       # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ä¸»è¦ã‚¯ãƒ©ã‚¹

### InvoiceChecker
- **GPT-4.1**: è«‹æ±‚æ›¸å†…å®¹ã®åˆ†æã¨ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¢ãƒ‡ãƒ«å›ºå®šï¼‰
- **LangChain**: PydanticOutputParserã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
- **Structured Output**: CheckResultãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹æ§‹é€ åŒ–ã•ã‚ŒãŸå‡ºåŠ›
- **ä¸¦åˆ—å‡¦ç†**: concurrent.futuresã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒãƒ«ãƒãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ§‹é€ åŒ–å‡ºåŠ›è§£æå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

### RuleManager
- **CRUDæ“ä½œ**: ãƒ«ãƒ¼ãƒ«ã®ä½œæˆãƒ»èª­ã¿å–ã‚Šãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- **UUIDç®¡ç†**: ä¸€æ„ãªãƒ«ãƒ¼ãƒ«IDç”Ÿæˆã¨ç®¡ç†
- **JSONä¿å­˜**: rules.jsonãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ°¸ç¶šåŒ–
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«**: 5ã¤ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã‚’åˆæœŸæä¾›
- **æ¤œç´¢æ©Ÿèƒ½**: ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢å¯¾å¿œ

### FileProcessor
- **å¤šå½¢å¼å¯¾å¿œ**: PDFï¼ˆPyPDF2ï¼‰ã€Excelï¼ˆpandas/openpyxlï¼‰ã€Wordï¼ˆpython-docxï¼‰
- **ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º**: å„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‹ã‚‰ã®æ§‹é€ åŒ–ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—**: ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã€ãƒšãƒ¼ã‚¸æ•°ã€ã‚·ãƒ¼ãƒˆæƒ…å ±ç­‰
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ»å½¢å¼ãƒ»åå‰ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å„ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã§ã®ä¾‹å¤–å‡¦ç†

## æŠ€è¡“è©³ç´°

### Structured Outputï¼ˆæ§‹é€ åŒ–å‡ºåŠ›ï¼‰

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯LangChainã®Pydantic Output Parserã‚’ä½¿ç”¨ã—ã¦å‹å®‰å…¨ãªå‡ºåŠ›å‡¦ç†ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ï¼š

```python
class SeverityLevel(str, Enum):
    INFO = "info"        # æ­£å¸¸
    WARNING = "warning"  # è­¦å‘Š
    ERROR = "error"      # ã‚¨ãƒ©ãƒ¼

class CheckResult(BaseModel):
    passed: bool = Field(description="ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹")
    severity: SeverityLevel = Field(description="é‡è¦åº¦ (info/warning/error)")
    message: str = Field(min_length=1, description="ãƒã‚§ãƒƒã‚¯çµæœã®èª¬æ˜")
    details: str = Field(default="", description="markdownå½¢å¼ã§è©³ç´°ãªåˆ¤æ–­æ ¹æ‹ ã‚’è¨˜è¼‰")
    
    @validator('severity')
    def severity_consistency_check(cls, v, values):
        """é‡è¦åº¦ã¨passedã®æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯"""
        passed = values.get('passed', True)
        if v == SeverityLevel.ERROR and passed:
            raise ValueError('errorã®å ´åˆã€passedã¯falseã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™')
        return v
```

#### ç‰¹å¾´
- **å‹å®‰å…¨æ€§**: Pydantic v2ã«ã‚ˆã‚‹Runtimeå‹ãƒã‚§ãƒƒã‚¯
- **ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼**: è‡ªå‹•çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ç­‰ï¼‰
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æƒ…å ±
- **æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**: é‡è¦åº¦ã¨passedçŠ¶æ…‹ã®è«–ç†çš„æ•´åˆæ€§ç¢ºèª
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: æ§‹é€ åŒ–å‡ºåŠ›è§£æå¤±æ•—æ™‚ã®å®‰å…¨ãªå‡¦ç†

### ä¸¦åˆ—å‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# ThreadPoolExecutorã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†
with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:
    futures = {}
    for file_data in files:
        future = executor.submit(check_invoice, file_data, rules)
        futures[future] = file_name
    
    # å®Œäº†é †ã«çµæœã‚’åé›†
    for future in concurrent.futures.as_completed(futures):
        result = future.result()
        # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
```

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### æ–°ã—ã„ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ 

1. ã€Œãƒ«ãƒ¼ãƒ«è¨­å®šã€ã‚¿ãƒ–ã§ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
2. ã‚«ãƒ†ã‚´ãƒªã€ãƒ«ãƒ¼ãƒ«åã€ãƒã‚§ãƒƒã‚¯å†…å®¹ã‚’è¨­å®š  
3. ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•çš„ã«Structured Outputã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡ç¤ºã‚’è¿½åŠ 
4. rules.jsonã«æ°¸ç¶šåŒ–ã•ã‚ŒUUIDç®¡ç†

#### æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®å¯¾å¿œ

`file_processor.py`ã®`FileProcessor`ã‚¯ãƒ©ã‚¹ã‚’æ‹¡å¼µï¼š

```python
def _process_new_format(self, file_content: bytes, file_name: str) -> str:
    """æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®å‡¦ç†ã‚’å®Ÿè£…"""
    # å®Ÿè£…ã‚³ãƒ¼ãƒ‰
    return extracted_text
```

#### GPT-4.1ãƒ¢ãƒ‡ãƒ«è¨­å®š

`invoice_checker.py`ã§ãƒ¢ãƒ‡ãƒ«ãŒå›ºå®šã•ã‚Œã¦ã„ã¾ã™ [[memory:5049262]]ï¼š

```python
self.llm = ChatOpenAI(
    model_name="gpt-4.1",  # çµ¶å¯¾ã«å¤‰æ›´ç¦æ­¢
    openai_api_key=api_key,
)
```
